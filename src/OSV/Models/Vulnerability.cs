namespace OSV.Models;

/// <summary>
/// A vulnerability entry.
/// </summary>
public sealed record Vulnerability
{
    /// <summary>
    /// The OSV schema version.
    /// </summary>
    [JsonPropertyName("schema_version")]
    public string SchemaVersion { get; init; } = null!;

    /// <summary>
    /// The `id` field is a unique identifier for the vulnerability entry.
    /// It is a string of the format &lt;DB&gt;-&lt;ENTRYID&gt;, where DB names the database and `ENTRYID` is in the format used by the database.
    /// For example: OSV-2020-111, CVE-2021-3114, or GHSA-vp9c-fpxx-744v.
    /// </summary>
    [JsonPropertyName("id")]
    public string Id { get; init; } = null!;

    /// <summary>
    /// The RFC3339 timestamp indicating when this entry was published.
    /// </summary>
    [JsonPropertyName("published")]
    public DateTimeOffset Published { get; init; }

    /// <summary>
    /// The RFC3339 timestamp indicating when this entry was last modified.
    /// </summary>
    [JsonPropertyName("modified")]
    public DateTimeOffset Modified { get; init; }

    /// <summary>
    /// Optional.
    /// The RFC3339 timestamp indicating when this entry is considered to be withdrawn.
    /// </summary>
    [JsonPropertyName("withdrawn")]
    public DateTimeOffset? Withdrawn { get; init; }

    /// <summary>
    /// Optional.
    /// IDs for the same vulnerability in other databases.
    /// </summary>
    [JsonPropertyName("aliases")]
    public IEnumerable<string>? Aliases { get; init; }

    /// <summary>
    /// Optional.
    /// List of IDs of closely related vulnerabilities, such as the same problem in alternate ecosystems.
    /// </summary>
    [JsonPropertyName("related")]
    public IEnumerable<string>? Related { get; init; }

    /// <summary>
    /// Required.
    /// Package information.
    /// </summary>
    [JsonPropertyName("package")]
    public Package Package { get; init; } = null!;

    /// <summary>
    /// Required.
    /// One line human readable summary for the vulnerability.
    /// It is recommended to keep this under 120 characters.
    /// </summary>
    [JsonPropertyName("summary")]
    public string Summary { get; init; } = null!;

    /// <summary>
    /// Required.
    /// Any additional human readable details for the vulnerability.
    /// </summary>
    [JsonPropertyName("details")]
    public string Details { get; init; } = null!;

    /// <summary>
    /// Required.
    /// Affected commit ranges and versions.
    /// </summary>
    [JsonPropertyName("affected")]
    public IEnumerable<Affected> Affected { get; init; } = null!;

    /// <summary>
    /// Optional.
    /// URLs to more information/advisories (including the scheme e.g "https://").
    /// </summary>
    [JsonPropertyName("references")]
    public IEnumerable<Reference>? References { get; init; } = null!;

    /// <summary>
    /// Optional.
    /// Severity of the vulnerability.
    /// </summary>
    [JsonPropertyName("severity")]
    public Severity? Severity { get; init; }

    /// <summary>
    /// Optional
    /// Credits for the vulnerability.
    /// </summary>
    [JsonPropertyName("credits")]
    public IEnumerable<Credit>? Credits { get; init; }

    /// <summary>
    /// Optional.
    /// JSON object holding additional information about the vulnerability as defined by the database for which the record applies.
    /// </summary>
    [JsonPropertyName("database_specific")]
    public Dictionary<string, object>? DatabaseSpecific { get; init; }
}
